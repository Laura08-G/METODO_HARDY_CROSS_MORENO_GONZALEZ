<!DOCTYPE html> 
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Portada Proyecto de Grado</title>
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background: #0d1b2a;
        color: white;
        text-align: center;
        overflow-x: hidden;
    }

    .top-section {
        position: relative;
        height: 60vh;
        overflow: hidden;
    }

    .overlay {
        position: relative;
        z-index: 2;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 40px;
        border-radius: 15px;
        max-width: 900px;
        margin: auto;
        margin-top: 15vh;
    }

    h1 { font-size: 2.2em; margin-bottom: 20px; }
    h2 { font-size: 1.3em; margin-top: 0; }

    .drop {
        position: absolute;
        top: -20px;
        width: 10px;
        height: 10px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 50%;
        animation: fall linear infinite;
    }

    @keyframes fall {
        to { transform: translateY(100vh); opacity: 0; }
    }

    .franja {
        background-color: #0077b6;
        padding: 15px;
        font-weight: bold;
        font-size: 1.2em;
        letter-spacing: 1px;
    }

    .info-section {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #14273d;
        padding: 30px;
        gap: 30px;
        flex-wrap: wrap;
        text-align: justify;
    }

    .info-section img {
        max-width: 300px;
        border-radius: 15px;
        box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }

    .info-text {
        max-width: 600px;
        font-size: 1em;
        line-height: 1.5;
    }

    .bottom-section {
        background-color: #14273d;
        padding: 30px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
    }

    .grafica-neon {
        width: 418px;
        height: 209px;
        border: 5px solid rgba(0, 255, 255, 1);
        border-radius: 20px;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.8),
                    0 0 50px rgba(0, 255, 255, 0.6);
        background-color: black;
        padding: 5px;
    }

    .grafica-verde {
        width: 418px;
        height: 209px;
        border: 5px solid rgba(0, 255, 0, 1);
        border-radius: 20px;
        box-shadow: 0 0 25px rgba(0, 255, 0, 0.8),
                    0 0 50px rgba(0, 255, 0, 0.6);
        background-color: black;
        padding: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    iframe {
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 15px;
    }

    .datos {
        background-color: yellow;
        color: black;
        font-weight: bold;
        padding: 10px;
        border-radius: 10px;
        margin: 20px auto;
        text-align: center;
        width: 80%;
    }

    table, th, td { border: 1px solid yellow; }
    table {
        border-collapse: collapse;
        width: 90%;
        margin: 20px auto;
        font-size: 14px;
        border-radius: 20px;
        border: 3px solid yellow;
        overflow: hidden;
        text-align: center;
        color: white;
    }
    th, td { padding: 8px; }

    .authors {
        margin-top: 20px;
        font-size: 1em;
        opacity: 0.85;
        width: 100%;
    }

    .pdf-section {
        margin: 20px auto;
        text-align: center;
    }

    .pdf-section img {
        width: 80px;
        display: block;
        margin: 0 auto 10px auto;
    }

    .pdf-button {
        margin: 10px auto;
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        background: yellow;
        color: black;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.3s;
    }
    .pdf-button:hover { background: orange; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

    <div class="top-section" id="top-section">
        <script>
            const totalDrops = 50;
            const topSection = document.getElementById("top-section");
            for (let i = 0; i < totalDrops; i++) {
                const drop = document.createElement("div");
                drop.classList.add("drop");
                drop.style.left = Math.random() * 100 + "vw";
                drop.style.animationDuration = 2 + Math.random() * 3 + "s";
                drop.style.animationDelay = Math.random() * 5 + "s";
                topSection.appendChild(drop);
            }
        </script>
        <div class="overlay">
            <h2>Universidad Distrital Francisco José de Caldas</h2>
            <h1>Aplicación de IoT en el monitoreo de un modelo hidráulico experimental basado en el método de Hardy Cross</h1>
        </div>
    </div>

    <!-- Nueva franja de Información Proyecto -->
    <div class="franja">| Información Proyecto | Tiempo real |</div>
    <div class="info-section">
        <img src="MONTAJE.jpg" alt="Montaje Experimental">
        <div class="info-text">
            El presente proyecto tiene como finalidad el desarrollo de un sistema de monitoreo en tiempo real aplicado a un modelo hidráulico experimental, utilizando tecnologías de Internet de las Cosas (IoT) y la plataforma Arduino (ESP32).  
            Se integraron sensores de caudal tipo YF-S201, una pantalla TFT para visualización local, un módulo lector de microSD para respaldo de datos, y conexión a la plataforma ThingSpeak para la supervisión remota.  
            Los datos obtenidos fueron analizados mediante el método iterativo de Hardy Cross con el fin de verificar el equilibrio hidráulico en redes cerradas de tuberías.  
            Esta propuesta demuestra cómo la automatización y la IoT pueden mejorar la precisión, eficiencia y accesibilidad del monitoreo en sistemas hidráulicos, representando una alternativa moderna frente a métodos tradicionales.
        </div>
    </div>

    <div class="franja">|  Monitoreo de caudal  |  Tiempo real  |</div>

    <div class="bottom-section">
        <div class="grafica-neon"><iframe src="https://thingspeak.mathworks.com/channels/3013756/charts/1?bgcolor=%23000000&color=%2300ffff&dynamic=true&results=60&type=line&update=15"></iframe></div>
        <div class="grafica-verde"><iframe src="https://thingspeak.mathworks.com/channels/3013756/charts/2?bgcolor=%23000000&color=%2300ff00&dynamic=true&results=60&type=line&update=15"></iframe></div>
        <div class="grafica-neon"><iframe src="https://thingspeak.mathworks.com/channels/3013756/charts/3?bgcolor=%23000000&color=%2300ffff&dynamic=true&results=60&type=line&update=15"></iframe></div>
        <div class="grafica-verde"><iframe src="https://thingspeak.mathworks.com/channels/3013756/charts/4?bgcolor=%23000000&color=%2300ff00&dynamic=true&results=60&type=line&update=15"></iframe></div>
        <div class="grafica-neon"><iframe src="https://thingspeak.mathworks.com/channels/3013756/charts/5?bgcolor=%23000000&color=%2300ffff&dynamic=true&results=60&type=line&update=15"></iframe></div>
        <div class="grafica-verde"><canvas id="combinedBarChart"></canvas></div>
    </div>

    <div class="franja">|  Datos  |  Tiempo real  | </div>

    <div class="datos">
        <h1>Proyecto de Grado - Método de Hardy Cross</h1>
        <p>(Moreno, Gonzalez)</p>
    </div>

    <table id="dataTable">
        <thead>
            <tr>
                <th>Sensor</th>
                <th>Caudal (L/Seg)</th>
                <th>Date & Time</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>YF-S201 #1</td><td id="sensor1">-</td><td id="time1">-</td></tr>
            <tr><td>YF-S201 #2</td><td id="sensor2">-</td><td id="time2">-</td></tr>
            <tr><td>YF-S201 #3</td><td id="sensor3">-</td><td id="time3">-</td></tr>
            <tr><td>YF-S201 #4</td><td id="sensor4">-</td><td id="time4">-</td></tr>
            <tr><td>YF-S201 #5</td><td id="sensor5">-</td><td id="time5">-</td></tr>
        </tbody>
    </table>

    <div class="franja">|  Descarga de información  |  Tiempo real  |</div>

    <!-- Imagen + Botón PDF -->
    <div class="pdf-section">
        <img src="pdf-icon.png" alt="Descargar PDF">
        <button class="pdf-button" onclick="downloadPDF()">Descargar PDF</button>
    </div>

    <div class="authors">Brayan Moreno, Laura Gonzalez</div>

<script>
const channelId = 3013756;
const fields = [1, 2, 3, 4, 5];

async function getLastFieldValue(field) {
    const url = `https://api.thingspeak.com/channels/${channelId}/fields/${field}/last.json`;
    try {
        const response = await fetch(url);
        const data = await response.json();
        return {
            value: parseFloat(data[`field${field}`]) || 0,
            time: new Date(data.created_at).toLocaleString()
        };
    } catch (error) {
        console.error("Error al obtener datos campo", field, error);
        return { value: 0, time: "-" };
    }
}

async function updateTableAndChart() {
    const labels = fields.map(f => `Sensor ${f}`);
    const dataValues = [];

    for (let i = 0; i < fields.length; i++) {
        const f = fields[i];
        const { value, time } = await getLastFieldValue(f);
        dataValues.push(value);
        document.getElementById(`sensor${i+1}`).innerText = value.toFixed(2);
        document.getElementById(`time${i+1}`).innerText = time;
    }

    const ctx = document.getElementById("combinedBarChart").getContext("2d");
    if (window.barChart) window.barChart.destroy();
    window.barChart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: "Valor actual",
                data: dataValues,
                backgroundColor: "rgba(0, 255, 0, 0.7)",
                borderColor: "rgba(0, 255, 0, 1)",
                borderWidth: 1,
                borderRadius: 8,
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, ticks: { color: "white" }, grid: { color: "rgba(255,255,255,0.1)" } },
                x: { ticks: { color: "white" }, grid: { display: false } }
            },
            plugins: { legend: { labels: { color: "white" } } }
        }
    });
}

// Exportar tabla como PDF
function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Texto de cabecera
    doc.text("Reporte de Sensores - Método de Hardy Cross", 14, 15);

    // Insertar imagen (logo PDF)
    const img = new Image();
    img.src = "pdf-icon.png"; 
    img.onload = function () {
        doc.addImage(img, "PNG", 160, 5, 40, 40);

        // Tabla de datos
        doc.autoTable({ html: "#dataTable", startY: 50 });

        // Guardar archivo
        doc.save("reporte_sensores.pdf");
    };
}

updateTableAndChart();
setInterval(updateTableAndChart, 20000);
</script>

</body>
</html>


